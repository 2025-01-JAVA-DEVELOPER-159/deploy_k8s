# Service

> ClusterIP, NodePort, LoadBalancer

  [alt text](image-3.png)


  ## 1. ClusterIP  

    ![alt text](image-13.png)





  ### 1-1) Pod

  ```yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-1
  labels:
     app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: k8s-node1
  containers:
  - name: container
    image: kubetm/app
    ports:
    - containerPort: 8080
  ```
    


  ### 1-2) Service


  ```yml
apiVersion: v1
kind: Service
metadata:
  name: svc-1
spec:
  selector:
    app: pod
  ports:
  - port: 9000
    targetPort: 8080
  type: ClusterIP  
  ```

```bash
[root@k8s-master ~]# curl 10.98.59.131:9000/hostname
```
- pod 삭제후 다시생성 pod IP는 변경 됐으나 service객체IP는 그대로임

```bash
[root@k8s-master ~]# curl 10.98.59.131:9000/hostname
```


## 2. NodePort

![alt text](image-14.png)

  ### 2-1) Service

```yml
apiVersion: v1
kind: Service
metadata:
  name: svc-2
spec:
  selector:
    app: pod
  ports:
  - port: 9000
    targetPort: 8080
    nodePort: 30001
  type: NodePort
  externalTrafficPolicy: Local
  ```

  ```dos
  C:\Users\itwill>curl 192.168.56.31:30001/hostname
  Hostname : pod-1

  ```

```yml
apiVersion: v1
kind: Pod
metadata:
  name: pod-2
  labels:
     app: pod
spec:
  nodeSelector:
    kubernetes.io/hostname: k8s-node2
  containers:
  - name: container
    image: kubetm/app
    ports:
    - containerPort: 8080
```  

- pod로 트레픽이분산되서 요청됨
- local  node에있는 pod만서비스해줌(externalTrafficPolicy: Local)

> kubernetes dahsboard UI Port가 30000으로 변경되어 해당 실습 port는 30001로 하시면 됩니다.


## 3. Load Balancer

![alt text](image-15.png)

  ### 3-1) Service

```yml
apiVersion: v1
kind: Service
metadata:
  name: svc-3
spec:
  selector:
    app: pod
  ports:
  - port: 9000
    targetPort: 8080
  type: LoadBalancer
```  

```bash
kubectl get service svc-3
```